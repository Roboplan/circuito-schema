{
  "definitions": {
    "supportedControllers": {
      "type": "array",
      "title": "Supported Controllers",
      "items": {
        "type": "string",
        "enum": [
          "ATMega328P",
          "ArduinoLeonardo",
          "ArduinoMega",
          "ArduinoMicro",
          "ArduinoNano",
          "ArduinoProMini5v",
          "ArduinoUno",
          "Arduino101",
          "ATTiny85",
          "Teensy32",
          "ArduinoGemma",
          "ArduinoProMini3v3",
          "ESP32DevKitC",
          "NodeMCU",
          "RPI3B"
        ]
      },
      "uniqueItems": true
    },
    "spec": {
      "type": "string",
      "default": "",
      "enum": [
        "",
        "ADC",
        "Barrel",
        "BARREL_JACK",
        "Battery",
        "CapTouch",
        "CTS",
        "DAC",
        "DCMA1",
        "DCMA2",
        "DCMB1",
        "DCMB2",
        "DigitalIn",
        "DigitalIn-Int",
        "DigitalOut",
        "DTR",
        "ESPSoftwareSerialRX",
        "ESPSoftwareSerialRX1",
        "ESPSoftwareSerialTag",
        "ESPSoftwareSerialTX",
        "ESPSoftwareSerialTX1",
        "FTDI",
        "GndLoadSwitching",
        "GndLoadSwitching-PWM",
        "IORef",
        "MISO",
        "MISO1",
        "MOSI",
        "MOSI1",
        "PWM",
        "RX",
        "RX2",
        "RX3",
        "SCK",
        "SCK1",
        "SCL",
        "SDA",
        "SoftwareSerial",
        "SRAMLoad",
        "SS",
        "Timer2",
        "TX",
        "TX2",
        "TX3",
        "USB",
        "USB_B",
        "USB_MICRO",
        "USB_MINI"
      ]
    },
    "voltage": {
      "type": "string",
      "enum": ["", "GND", "3.3v", "3.7v", "5v", "6v", "7.4v", "9v", "12v"]
    }
  },
  "type": "object",
  "required": ["name", "category"],
  "additionalProperties": false,
  "properties": {
    "path": {
      "type": "string"
    },
    "name": {
      "type": "string",
      "title": "Name"
    },
    "category": {
      "title": "Category",
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "output",
          "input",
          "controller",
          "power",
          "connectivity",
          "powerConnector",
          "support"
        ]
      },
      "uniqueItems": true
    },
    "blockId": {
      "type": "string",
      "title": "Block ID"
    },
    "app": {
      "type": "object",
      "title": "Appearance",
      "required": ["appName", "desc"],
      "additionalProperties": false,
      "properties": {
        "appName": {
          "type": "string",
          "title": "Application name"
        },
        "image": {
          "type": "string",
          "title": "Image"
        },
        "numericName": {
          "type": "string",
          "title": "Numeric name"
        },
        "shortName": {
          "type": "string",
          "title": "Short name"
        },
        "visible": {
          "type": "boolean",
          "title": "Visible in application"
        },
        "indicators": {
          "type": "object",
          "title": "Indicators",
          "additionalProperties": false,
          "properties": {
            "verified": {
              "type": "boolean",
              "default": false
            },
            "solder": {
              "type": "boolean",
              "title": "Requires soldering",
              "default": false
            }
          }
        },
        "desc": {
          "type": "string",
          "title": "Description"
        }
      }
    },
    "notes": {
      "type": "string",
      "title": "Notes and references"
    },
    "altComp": {
      "title": "Alternative block",
      "description": "Alternative block to try if this one failed",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "cost": {
          "title": "Alternative cost",
          "type": "integer"
        },
        "block": {
          "title": "Alternative block name",
          "type": "string"
        }
      }
    },
    "circuits": {
      "type": "array",
      "title": "",
      "items": {
        "type": "object",
        "required": ["name", "priority", "parts"],
        "additionalProperties": false,
        "properties": {
          "name": {
            "type": "string",
            "title": "Name"
          },
          "priority": {
            "type": "integer",
            "title": "Priority",
            "default": 0
          },
          "supportedControllers": {
            "$ref": "#/definitions/supportedControllers"
          },
          "parts": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["name", "part"],
              "additionalProperties": false,
              "properties": {
                "name": {
                  "type": "string",
                  "title": "Instance name"
                },
                "part": {
                  "type": "string",
                  "title": "Part"
                },
                "rotation": {
                  "type": "integer",
                  "title": "Rotation over-ride",
                  "description": "Specify part rotation (deg.) on canvas. Leave blank for auto-rotation",
                  "enum": [0, 90, 180, 270]
                }
              }
            }
          },
          "requiredBlocks": {
            "type": "array",
            "title": "Support Blocks",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "cost": {
                  "type": "integer",
                  "title": "Cost",
                  "default": 0
                },
                "blocks": {
                  "type": "array",
                  "title": "Blocks",
                  "items": {
                    "type": "string"
                  },
                  "uniqueItems": true
                }
              }
            }
          },
          "coders": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "ports": {
            "title": "",
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "interface"],
              "additionalProperties": false,
              "properties": {
                "name": {
                  "type": "string",
                  "title": "Port name",
                  "default": ""
                },
                "interface": {
                  "type": "object",
                  "required": ["portType"],
                  "properties": {
                    "portType": {
                      "title": "Type",
                      "type": "string",
                      "enum": ["requires", "provides", "chainable"],
                      "enumNames": ["Requires specs", "Provides specs", "Chainable Port"]
                    }
                  },
                  "dependencies": {
                    "portType": {
                      "oneOf": [
                        {
                          "additionalProperties": false,
                          "properties": {
                            "portType": {
                              "enum": ["requires"]
                            },
                            "requires": {
                              "type": "array",
                              "title": "Requires",
                              "minItems": 1,
                              "items": {
                                "type": "object",
                                "additionalProperties": false,
                                "properties": {
                                  "cost": {
                                    "type": "integer",
                                    "default": 0
                                  },
                                  "spec": { "$ref": "#/definitions/spec" },
                                  "voltage": { "$ref": "#/definitions/voltage" }
                                }
                              }
                            },
                            "requiresLoad": {
                              "title": "Requires max load (mA)",
                              "type": "integer"
                            },
                            "unique": {
                              "title": "Unique port",
                              "type": "boolean",
                              "description": "No other ports will be routed to this port's provider"
                            },
                            "chainTo": {
                              "title": "Chain to port name",
                              "type": "string",
                              "description": "Chain to this port to another port when possible"
                            },
                            "isBus": {
                              "type": "boolean"
                            }
                          },
                          "required": ["requires"]
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "portType": {
                              "enum": ["provides"]
                            },
                            "provides": {
                              "type": "array",
                              "title": "Provides",
                              "items": {
                                "type": "object",
                                "additionalProperties": false,
                                "properties": {
                                  "spec": { "$ref": "#/definitions/spec" },
                                  "voltage": { "$ref": "#/definitions/voltage" }
                                }
                              }
                            },
                            "providesLoad": {
                              "title": "Provides max load (mA)",
                              "type": "integer"
                            },
                            "redirectLoad": {
                              "title": "Redirect load",
                              "type": "string",
                              "description": "Redirect load verification to another port (used for support blocks only)"
                            },
                            "chain": {
                              "title": "Port is chainable",
                              "type": "boolean",
                              "description": "Allow other ports the chain to this port"
                            },
                            "codename": {
                              "title": "Port codename [show for category controller only]",
                              "type": "string",
                              "default": "",
                              "description": "Override deafult port name used in coder (used for controllers only)"
                            },
                            "codenameRedirect": {
                              "title": "Codename redirect",
                              "type": "string",
                              "description": "Redirect coder to another port when resolving this port (used for support blocks only)"
                            }
                          },
                          "required": ["provides"]
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "portType": {
                              "enum": ["chainable"]
                            },
                            "chain": {
                              "title": "Port is chainable",
                              "type": "boolean",
                              "description": "Allow other ports the chain to this port"
                            }
                          },
                          "required": ["chain"]
                        }
                      ]
                    }
                  }
                },
                "includeInFirmware": {
                  "type": "boolean",
                  "title": "Include in firmware",
                  "description": "Create coder variable for port"
                }
              }
            }
          },
          "wires": {
            "title": "",
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "from": {
                  "type": "string",
                  "title": "From pin/port",
                  "default": ""
                },
                "to": {
                  "type": "string",
                  "title": "To pin/port",
                  "default": ""
                }
              }
            }
          }
        }
      }
    }
  }
}
